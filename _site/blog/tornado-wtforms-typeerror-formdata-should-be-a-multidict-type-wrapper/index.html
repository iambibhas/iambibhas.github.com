<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <meta charset="utf-8">
  <title>
    
      Tornado + WTForms = TypeError: formdata should be a multidict type wrapper ... &ndash;
    
    Bibhas C Debnath
  </title>

  <meta name="author" content="Bibhas C Debnath" />
  <meta name="description" content="Lazy to the core" />

  <link rel="alternate" type="application/rss+xml" href="/atom.xml" />

  <link rel="stylesheet" href="/css/base.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
  <link media="only screen and (max-device-width: 480px)" href="/css/iphone.css" type="text/css" rel="stylesheet" />
  <link media="only screen and (device-width: 768px)" href="/css/iphone.css" type="text/css" rel="stylesheet" />
  <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/css/shCore.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="/css/app.css" type="text/css" media="screen, projection" />

  <script type="text/javascript" src="/js/jquery.min.js"></script>

  
  <script type="text/javascript" src="/js/shCore.js"></script>
  <script type="text/javascript" src="/js/shBrushPlain.js"></script>
  <script type="text/javascript" src="/js/shBrushJScript.js"></script>
  

  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>
  <script type="text/javascript" src="/js/application.js"></script>
</head>

<body>
  <section class="sidebar" align="right">
    <a href="/">
      <img src="http://www.gravatar.com/avatar/ffbd494728961d8baf2c7404dc420152?s=150" height="75" width="75" class="avatar" />
    </a>

    <section class="name">
      <a href="/">
        <span id="fname">Bibhas</span><br>
        <span id="lname">Debnath</span>
      </a>
    </section>

    <section class="meta">
      <a href="https://github.com/iambibhas" target="_blank"><img src="/images/github.png" /></a>
      <a href="https://twitter.com/iAmBibhas" target="_blank"><img src="/images/twitter.png"></a>
      <a href="/atom.xml"><img src="/images/rss.png" /></a>
    </section>

    <section class="sections">
      <ul>
        <li><a href="/about-me/">about</a></li>
        <li><a href="/blog/">posts</a></li>
        <li><a href="/search/all/">Moderated Search</a></li>
      </ul>
    </section>
    <section class="sections">
        <a href="https://twitter.com/iAmBibhas" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @iAmBibhas</a>
    </section>
    <section class="sections">
        <a href="http://stackexchange.com/users/94480/bibhas">
            <img src="http://stackexchange.com/users/flair/94480.png" width="208" height="58" alt="profile for Bibhas on Stack Exchange, a network of free, community-driven Q&amp;A sites" title="profile for Bibhas on Stack Exchange, a network of free, community-driven Q&amp;A sites" />
        </a>
    </section>
    <section id="gittip">
        <p>
            <a href="https://www.gittip.com/on/github/iambibhas">
            <img src="https://464cb7500b7b22c45962-7e649de06c64f44fd9a5706b67a55744.ssl.cf2.rackcdn.com//img/gittip_icon.png" alt="gittip">
            Fund me on Gittip!</a>
        </p>
    </section>
  </section>

  <section class="content">
  <h1>
    <a href="/blog/tornado-wtforms-typeerror-formdata-should-be-a-multidict-type-wrapper/">Tornado + WTForms = TypeError: formdata should be a multidict type wrapper ...</a>
  </h1>

  <section class="byline">
    April 25, 2013
  </section>

  <p>If you&rsquo;re here from some search engine, that means you&rsquo;ve been working with Tornado and WTForms, and you&rsquo;ve faced the same error &ndash;</p>

<pre><code>(Pdb) form = SomeForm(self.request.arguments)
*** TypeError: formdata should be a multidict-type wrapper that supports the 'getlist' method
</code></pre>

<p>The thing is, Tornado does provide a dictionary that contains the data like a MultiDict should do for GET/POST/others request arguments &ndash;</p>

<pre><code>{'_xsrf': ['b2c0d0bebbf84516a8aa0462bb41ea0f'], 'password': ['password'], 'email': ['mail@gmail.com']}
</code></pre>

<p>But it sends it as a dictionary &ndash;</p>

<pre><code>(Pdb) type(self.request.arguments)
&lt;type 'dict'&gt;
</code></pre>

<p>And Python dictionaries don&rsquo;t have a <code>getlist()</code> method. And WTForms requires the arguments object to have that method.</p>

<p>Workaround?</p>

<pre><code>class SimpleMultiDict(dict):
    def getlist(self, key):
        return self[key]

    def __repr__(self):
        return type(self).__name__ + '(' + dict.__repr__(self) + ')'
</code></pre>

<p>This simply makes a subclass of <code>dict</code> and adds the <code>getlist()</code> method. So, What did we gain?</p>

<pre><code>(Pdb) SimpleMultiDict(self.request.arguments)
SimpleMultiDict({'_xsrf': ['b2c0d0bebbf84516a8aa0462bb41ea0f'], 'password': ['password'], 'email': ['mail@gmail.com']})
(Pdb) arguments = SimpleMultiDict(self.request.arguments)
(Pdb) dir(arguments)
['__class__', (skipping some default methods) , 'clear', 'copy', 'fromkeys', 'get', 'getlist', 'has_key', 'items', 'iteritems', 'iterkeys', 'itervalues', 'keys', 'pop', 'popitem', 'setdefault', 'update', 'values', 'viewitems', 'viewkeys', 'viewvalues']

# Notice the getlist() method

(Pdb) arguments.getlist('email')
['mail@gmail.com']
(Pdb) form = LoginForm(arguments)
(Pdb) form.email.data
'mail@gmail.com'
</code></pre>

<p>Now there is a point to note here. Tornado sends the arguments data in a simple dictionary that has each of the values inside a list. Here is a pointer if you&rsquo;re using some framework that sends a simple dictionary, with the arguments <em>not</em> in list, and that also doesn&rsquo;t have a <code>getlist()</code> method, just change the <code>getlist()</code> method to this &ndash;</p>

<pre><code>class SimpleMultiDict(dict):
    def getlist(self, key):
        return self[key] if type(self[key]) == list else [self[key]]

    def __repr__(self):
        return type(self).__name__ + '(' + dict.__repr__(self) + ')'
</code></pre>

<p>This just turns the simgle values to a list, just what <code>getlist()</code> is supposed to do.</p>


  <!-- TODO: bio here -->
  <section class="meta">
    <h3>Discussion, links, and tweets</h3>
    <section class="copy">
      <a href="https://twitter.com/iAmBibhas" target="_blank">
        <img src="http://www.gravatar.com/avatar/ffbd494728961d8baf2c7404dc420152?s=142" height="50" width="50" />
      </a>

      <p>
        I'm a Ninja/Kickass/Rockstar Developer, NOT. <a href="https://twitter.com/iAmBibhas" target="_blank">Follow me on Twitter</a>;
      </p>

      <a href="https://twitter.com/share" class="twitter-share-button" data-via="iAmBibhas">Tweet</a>
      <div class="g-plusone" data-size="tall" data-annotation="none"></div>
    </section>
    <section style="padding-right: 20px; margin-top: 10px">
        
            <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'bee-mblog'; // required: replace example with your forum shortname
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

        
    </section>
  </section>
</section>


    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-3724476-6']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>

<script type="text/javascript">
     SyntaxHighlighter.all()
</script>
</body>

</html>
